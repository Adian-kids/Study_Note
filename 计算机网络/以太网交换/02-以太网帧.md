# 以太网封装

本模块首先讨论以太网技术，包括解释 MAC 子层和以太网帧字段。

以太网是如今广泛使用的两种局域网技术之一，另一种是无线局域网（WLAN）。它使用有线通信，包括双绞线、光纤链路和同轴电缆。

以太网在数据链路层和物理层运行，是 IEEE 802.2 和 802.3 标准中定义的一系列网络技术。以太网支持的数据带宽为：

- 10 Mbps
- 100 Mbps
- 1000 Mbps (1 Gbps)
- 10,000 Mbps (10 Gbps)
- 40,000 Mbps (40 Gbps)
- 100,000 Mbps (100 Gbps)

如图所示，以太网标准同时定义第 2 层协议和第 1 层技术。

![](pic/1.png)

# 数据链路子层

IEEE 802 LAN/MAN 协议，包括以太网，使用以下两个单独的数据链路层子层进行操作。它们是逻辑链路控制 (LLC) 和介质访问控制 (MAC)，如图所示。

回想一下，LLC 和 MAC 在数据链接层中具有以下角色：

- **LLC 子层** - 此 IEEE 802.2 子层在上层的网络软件与下层的设备硬件之间进行通信。它放入帧中的信息用于确定帧所使用的网络层协议。此信息允许多个第 3 层协议（如 IPv4 和 IPv6）使用相同的网络接口和介质。
- **MAC 子层** - 此子层（例如 IEEE 802.3、802.11 或 802.15）在硬件中实现，负责数据封装和介质访问控制。它提供数据链路层寻址，并与各种物理层技术集成。
- ![](pic/2.png)

# MAC 子层

MAC 子层负责数据封装和访问介质。

**数据封装**

IEEE 802.3 数据封装包括以下内容：

- **以太网帧** - 这是以太网帧的内部结构。
- **以太网寻址** - 以太网帧中包含源和目的MAC 地址，用于将该以太网帧从以太网网卡传送到同一LAN上的以太网网卡。
- **以太网错误检测** - 以太网帧中包含用于错误检测的帧校验序列 (FCS) 帧尾。

**访问介质**

如图所示，IEEE 802.3 MAC 子层包含了在各种介质(包括铜和光纤)上不同类型的以太网通信标准的规格。

该图显示了MAC 子层中的各种以太网标准。图的顶部是网络层和网络层协议。下面是数据链接图层及其子层。顶部子层是 IEEE 802.2 LLC子层。接下来是以太网 IEEE 802.3 MAC 子层。下面五列是不同的以太网标准和媒体类型，它们跨越了MAC子层的下部和整个OSI物理层。这几列从左到右分别是：IEEE 802.3u 快速以太网；IEEE 802.3z 基于光纤的千兆以太网；IEEE 802.ab 基于铜的千兆以太网；IEEE 802.3ae 基于光纤的万兆以太网；等等。

### MAC 子层中的以太网标准

![](pic/3.png)



回想一下，使用总线拓扑或集线器的传统以太网是一种共享的半双工介质。半双工介质上的以太网使用争用访问方法，即载波侦听多路访问/冲突检测 (CSMA/CD)，这确保一次只有一个设备进行传输。CSMA/CD 允许多个设备共享相同的半双工介质，如果多台设备同时传输，则会发生冲突。它还提供了一种回退重传算法。

如今的以太网 LANs 使用的交换机是全双工的。在全双工模式下运行的以太网交换机不需要通过 CSMA/CD 进行访问控制。

## 以太网帧字段

以太网帧大小的最小值为 64 个字节，最大值为 1518 个字节。这包括从“目的 MAC 地址”字段到“帧校验序列 (FCS)”字段的所有字节。在描述帧的大小时，不包含“前导码”字段。

任何长度小于 64 个字节的帧都被接收站点视为“冲突碎片”或“残帧”而自动丢弃。超过 1500 个字节的数据帧被视为“巨帧”或“小型巨型帧”。

如果发送的帧小于最小值或者大于最大值，接收设备将会丢弃该帧。帧之所以被丢弃，可能是因为冲突或其他多余信号。它们被视为无效。大多数快速以太网和千兆以太网交换机和网卡通常都支持巨帧。

这张图显示了以太网帧中的每个字段。有关每个字段功能的详细信息，请参阅表格。

这张图显示了一个以太网帧的所有字段。从左至右，字段及其长度为：前导码和帧首定界符SFD，8 字节；目的 MAC 地址，6 字节；源 MAC 地址，6 字节；类型/长度，2 字节；数据，45-1500 字节；帧校验序列FCS，4 字节。除第一个字段外，其余字段中的总字节数介于 64 到 1518 之间。

### Ethernet Frame Fields

![](pic/4.png)



### 以太网帧字段细节

| 字段                   | 说明                                                         |
| :--------------------- | :----------------------------------------------------------- |
| 前导码和帧首定界符字段 | 前导码（7 字节）和帧首定界符（SFD），也称为 帧首（1 字节），该字段用于发送设备 与接收设备之间的同步。帧开头的八个字节 用于引起接收节点的注意。基本上，前几个字节的 作用是告诉接收方准备接收新帧。 |
| 目的 MAC 地址字段      | 该 6 字节字段是预期接收方的标识符。读者应该还记得， 此地址被第2层用来协助设备 确定帧是否发送到目的地。帧中的地址将会与设备中的 MAC 地址进行比对。如果匹配， 设备就接受该帧。可以是单播、组播或广播 地址。 |
| 源 MAC 地址字段        | 该 6 字节字段标识发出帧的网卡 或接口。                       |
| 类型/长度              | 该字段包含两个字节，标识封装于以太网帧中的 上层协议。常见值为十六进制，0x800 用于 IPv4， 0x86DD 用于 IPv6，0x806 用于 ARP。 **注意**：您也可能会看到此字段称为 EtherType、类型或长度。 |
| 数据字段               | 该字段（46-1500 字节）包含来自 较高层的封装数据，一般是第3层PDU或更常见的IPv4 数据包。所有帧至少必须有 64 个字节。如果封装的是小数据包， 则使用填充位将帧 增大到最小值。 |
| 帧校验序列字段         | “帧校验序列 (FCS)”字段（4 个字节）用于检测帧中 的错误。它使用循环冗余校验 (CRC)。发送设备 在帧的 FCS 字段中包含 CRC 的结果。接收设备 接收帧并生成 CRC 以查找 错误。如果计算匹配，就不会发生错误。计算 不匹配则表明数据已经改变。因此， 帧会被丢弃。数据的变化可能是 由于代表比特位的电信号受到干扰所致。 |