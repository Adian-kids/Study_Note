# 对消息分段

当您学习数据在网络中移动时如何封装的时候，了解 OSI 参考模型和 TCP/IP 协议模型就会派上用场。它不像通过邮件系统发送的实体信件那么简单。

理论上来说，可以将一次通信的内容（如音乐视频或有很多很大的附件的电子邮件）作为一大块连续的高容量比特流，通过网络从源发送到目的地。但是，这会给其他需要使用相同通信通道或链路的设备带来问题。这种大型数据流会导致严重的延迟。而且，一旦互联网络基础架构中的任何链路在传输期间出现故障，那么整个消息都会丢失，必须全部重传。

所以，更好的办法是先将数据划分为更小、更易于管理的片段，然后再通过网络发送。分段是将数据流划分成更小的单元，以便在通过网络传输的过程。分段是必要的，因为数据网络使用TCP/IP协议簇以单独的IP数据包发送数据。每个数据包都是单独发出的，类似于把一封长信作为一系列独立的明信片寄出。包含同一目的地数据段的数据包可以通过不同的路径发送。

这导致消息分段有两个主要好处:

- **提高速度** - 由于将大数据流分段成为数据包，因此可以在不独占通信链路的情况下，通过网络发送大量数据。这允许许多不同的会话在称为多路复用的网络上交错。
- **提高效率** - 如果单个数据段由于网络故障或网络拥塞而无法到达其目的地，则只需要重新传输该段，而不需要重新发送整个数据流。

点击图中的每个按钮，来观看分段和多路复用的动画演示。

# 排序

使用分段和多路复用在网络上传输消息要面临的挑战是增加了该过程的复杂程度。试想一下，这就如同您要邮寄一封 100 页的信件，但每个信封里只能装一页纸。因此，将需要100个信封，每一个信封都需要分别写好地址。100个不同的信封装着的100页的信有可能顺序是混乱的。因此，信封中的信息需要包含一个序列号，以确保接收者可以按适当的顺序重新组装页面。

在网络通信中，每个消息段也必须经过类似的过程才能确保其到达正确目的设备并重新组装成原始消息的内容，如图所示。TCP 负责对单独的数据段进行排序。

该图显示了两台计算机通过网络向一台服务器发送消息。每条消息都被分成多份，显示为黄色和橙色的信封，有些是交错排列并编号的。文字显示：标识多个片段以便定向和重组。标识用于在片段到达时对其排序和组装。

![](pic/7.png)

# 协议数据单元

在通过网络介质传输应用程序数据的过程中，随着数据沿协议栈向下传递，每层都要添加各种协议信息。此过程称为封装。

**注意**: 虽然UDP PDU被称为数据报，但IP数据包有时也被称为IP数据报。

一段数据在任意协议层的表示形式称为协议数据单元 (PDU)。在封装过程中，后续的每一层都根据使用的协议封装其从上一层接收的 PDU。在该过程的每个阶段，PDU 都以不同的名称来反映其新功能。尽管目前对 PDU 的命名没有通用约定，但本课程中根据 TCP/IP 协议簇的协议来命名 PDU。图中显示了每种形式数据的 PDU。

![](pic/8.png)

